+ patchdir=/usr/share/kata-ckan-prod/setup-patches
+ service tomcat6 stop
Stopping tomcat6: [  OK  ]
+ cd /etc/tomcat6
+ patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/tomcat6.conf.patch
patching file tomcat6.conf
+ python /usr/share/mcfg/tool/mcfg.py run /usr/share/mcfg/config/kata-template.ini /root/kata-master.ini 1
+ service tomcat6 start
Starting tomcat6: [  OK  ]
+ patchdir=/usr/share/kata-ckan-prod/setup-patches
+ service postgresql initdb
Initializing database: [  OK  ]
+ pushd /var/lib/pgsql/data
+ su -c 'patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/pg_hba.conf.patch' postgres
patching file pg_hba.conf
+ popd
+ service postgresql start
Starting postgresql service: [  OK  ]
+ chkconfig postgresql on
+ cmd='CREATE ROLE ckanuser PASSWORD '\''md5372712b8c6097730c3164ddd4f9275e0'\'' NOSUPERUSER NOCREATEDB NOCREATEROLE INHERIT LOGIN'
+ sleep 3
+ su -c 'psql -c "CREATE ROLE ckanuser PASSWORD '\''md5372712b8c6097730c3164ddd4f9275e0'\'' NOSUPERUSER NOCREATEDB NOCREATEROLE INHERIT LOGIN"' postgres
CREATE ROLE
+ su -c 'createdb -O ckanuser ckantest' postgres
+ '[' -f /tmp/kata-SKIP10 ']'
+ instloc=/home/ckan
+ cd /home/ckan
+ source pyenv/bin/activate
++ deactivate nondestructive
++ unset pydoc
++ '[' -n '' ']'
++ '[' -n '' ']'
++ '[' -n /bin/sh -o -n '' ']'
++ hash -r
++ '[' -n '' ']'
++ unset VIRTUAL_ENV
++ '[' '!' nondestructive = nondestructive ']'
++ VIRTUAL_ENV=/home/ckan/pyenv
++ export VIRTUAL_ENV
++ _OLD_VIRTUAL_PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin
++ PATH=/home/ckan/pyenv/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin
++ export PATH
++ '[' -n '' ']'
++ '[' -z '' ']'
++ _OLD_VIRTUAL_PS1=
++ '[' x '!=' x ']'
+++ basename /home/ckan/pyenv
++ '[' pyenv = __ ']'
+++ basename /home/ckan/pyenv
++ PS1='(pyenv)'
++ export PS1
++ alias 'pydoc=python -m pydoc'
++ '[' -n /bin/sh -o -n '' ']'
++ hash -r
+ cd pyenv/src/ckan
++ sed -E 's/ +inet +([^/]+).+/\1/'
++ grep 'inet '
++ ip addr show dev eth0
Device "eth0" does not exist.
+ myip=
+ sed -e 's,\(ckan.site_url = http://\)[^ ]*,\1,' development.ini
+ mv development.ini.1 development.ini
+ paster --plugin=ckan db init
2012-10-31 10:01:34,508 DEBUG [ckanext.harvest.model] Harvest tables defined in memory
2012-10-31 10:01:34,527 DEBUG [ckanext.harvest.model] Harvest table creation deferred
/home/ckan/pyenv/lib/python2.6/site-packages/sqlalchemy/engine/reflection.py:47: SAWarning: Skipped unsupported reflection of expression-based index idx_pkg_lname
  ret = fn(self, con, *args, **kw)
/home/ckan/pyenv/lib/python2.6/site-packages/sqlalchemy/engine/reflection.py:47: SAWarning: Skipped unsupported reflection of expression-based index idx_pkg_slname
  ret = fn(self, con, *args, **kw)
/home/ckan/pyenv/lib/python2.6/site-packages/sqlalchemy/engine/reflection.py:47: SAWarning: Skipped unsupported reflection of expression-based index idx_pkg_suname
  ret = fn(self, con, *args, **kw)
/home/ckan/pyenv/lib/python2.6/site-packages/sqlalchemy/engine/reflection.py:47: SAWarning: Skipped unsupported reflection of expression-based index idx_pkg_uname
  ret = fn(self, con, *args, **kw)
/home/ckan/pyenv/lib/python2.6/site-packages/sqlalchemy/engine/reflection.py:47: SAWarning: Skipped unsupported reflection of expression-based index idx_user_name_index
  ret = fn(self, con, *args, **kw)
2012-10-31 10:02:09,793 INFO  [ckan.model] CKAN database version upgraded: 0 -> 60
2012-10-31 10:02:09,988 INFO  [ckan.model] Database initialised
Initialising DB: SUCCESS
+ '[' -f /tmp/kata-SKIP10 ']'
+ instloc=/home/ckan
+ cd /home/ckan
+ source pyenv/bin/activate
++ deactivate nondestructive
++ unset pydoc
++ '[' -n '' ']'
++ '[' -n '' ']'
++ '[' -n /bin/sh -o -n '' ']'
++ hash -r
++ '[' -n '' ']'
++ unset VIRTUAL_ENV
++ '[' '!' nondestructive = nondestructive ']'
++ VIRTUAL_ENV=/home/ckan/pyenv
++ export VIRTUAL_ENV
++ _OLD_VIRTUAL_PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin
++ PATH=/home/ckan/pyenv/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin
++ export PATH
++ '[' -n '' ']'
++ '[' -z '' ']'
++ _OLD_VIRTUAL_PS1=
++ '[' x '!=' x ']'
+++ basename /home/ckan/pyenv
++ '[' pyenv = __ ']'
+++ basename /home/ckan/pyenv
++ PS1='(pyenv)'
++ export PS1
++ alias 'pydoc=python -m pydoc'
++ '[' -n /bin/sh -o -n '' ']'
++ hash -r
+ paster --plugin=ckanext-harvest harvester initdb --config=/home/ckan/pyenv/src/ckan/development.ini
2012-10-31 10:02:11,841 DEBUG [ckanext.harvest.model] Harvest tables defined in memory
2012-10-31 10:02:12,490 DEBUG [ckanext.harvest.model] Harvest tables created
2012-10-31 10:02:12,556 DEBUG [ckanext.harvest.plugin] Using auth profile at ckanext.harvest.logic.auth
2012-10-31 10:02:12,626 DEBUG [ckanext.harvest.model] Harvest tables already exist

DB tables created
+ packagedir=/usr/share/kata-ckan-prod
+ cp /etc/shibboleth/shibboleth2.xml /etc/shibboleth/shibboleth2.xml.bak
+ pushd /etc/shibboleth
+ patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/shibboleth2.xml.patch
patching file shibboleth2.xml
+ patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/attribute-map.xml.patch
patching file attribute-map.xml
+ patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/attribute-policy.xml.patch
+ popd
+ cp /etc/httpd/conf.d/shib.conf /etc/httpd/conf.d/shib.conf.bak
+ pushd /etc/httpd/conf.d
+ patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/shib.conf.patch
patching file shib.conf
Hunk #2 succeeded at 13 with fuzz 1.
+ popd
+ /usr/bin/python /usr/share/mcfg/tool/mcfg.py run /usr/share/mcfg/config/kata-template.ini /root/kata-master.ini 3
+ chown shibd:shibd /etc/shibboleth/spkey.pem
+ chmod og= /etc/shibboleth/spkey.pem
+ packagedir=/usr/share/kata-ckan-prod
+ cp /etc/httpd/conf.d/ssl.conf /etc/httpd/conf.d/ssl.conf.bak
+ pushd /etc/httpd/conf.d/
+ patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/ssl.conf.patch
patching file ssl.conf
+ /usr/bin/python /usr/share/mcfg/tool/mcfg.py run /usr/share/mcfg/config/kata-template.ini /root/kata-master.ini 7
+ popd
+ patchdir=/usr/share/kata-ckan-prod/setup-patches
+ service httpd stop
Stopping httpd: [FAILED]
+ pushd /etc/httpd/conf
+ patch -b -p2 -i /usr/share/kata-ckan-prod/setup-patches/httpd.conf.patch
patching file httpd.conf
+ mv httpd.conf httpd.conf.step1
++ dirname /usr/share/kata-ckan-prod/setup-scripts/20setupckanservice.sh
+ myipcmd=/usr/share/kata-ckan-prod/setup-scripts/myip.sh
++ /usr/share/kata-ckan-prod/setup-scripts/myip.sh
+ myip=192.168.122.158
+ sed -e s/%%MYIP%%/192.168.122.158/ httpd.conf.step1
+ /usr/bin/python /usr/share/mcfg/tool/mcfg.py run /usr/share/mcfg/config/kata-template.ini /root/kata-master.ini 20
+ popd
+ chkconfig httpd on
+ chown -R ckan:apache /home/ckan/pyenv
+ chmod -R 755 /home/ckan
+ setsebool -P httpd_can_network_connect 1
+ chcon -R --type=httpd_sys_content_t /home/ckan
+ touch /home/ckan/pyenv/ckan.log
+ chown ckan:apache /home/ckan/pyenv/ckan.log
+ chmod g+w /home/ckan/pyenv/ckan.log
+ chmod -R g+w /home/ckan/pyenv/src/ckan/data /home/ckan/pyenv/src/ckan/sstore
++ echo /usr/lib64/python2.6 /usr/lib/python2.6
+ for dir in '$(echo /usr/lib*/python2.6)'
+ sed -i.orig 's/CFUNCTYPE(c_int)(lambda: None)/#CFUNCTYPE(c_int)(lambda: None)/' /usr/lib64/python2.6/ctypes/__init__.py
+ for dir in '$(echo /usr/lib*/python2.6)'
+ sed -i.orig 's/CFUNCTYPE(c_int)(lambda: None)/#CFUNCTYPE(c_int)(lambda: None)/' /usr/lib/python2.6/ctypes/__init__.py
sed: can't read /usr/lib/python2.6/ctypes/__init__.py: No such file or directory
Stopping supervisord: [FAILED]
Starting supervisord: [  OK  ]
+ instloc=/home/ckan
+ cp /opt/solr/conf/schema.xml /opt/solr/conf/schema.xml.bak
+ cp /home/ckan/pyenv/src/ckan/ckan/config/solr/schema-1.4.xml /opt/solr/conf/schema.xml
+ service tomcat6 restart
Stopping tomcat6: [  OK  ]
Starting tomcat6: [  OK  ]
+ chkconfig tomcat6 on
+ instloc=/home/ckan
+ service rabbitmq-server start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.
+ chkconfig rabbitmq-server on
+ /home/ckan/pyenv/bin/paster --plugin=ckanext-harvest harvester source http://www.fsd.uta.fi/fi/aineistot/luettelo/fsd-ddi-records-uris-fi.txt DDI --config=/home/ckan/pyenv/src/ckan/development.ini
2012-10-31 10:03:47,413 DEBUG [ckanext.harvest.model] Harvest tables defined in memory
2012-10-31 10:03:47,420 DEBUG [ckanext.harvest.model] Harvest tables already exist
2012-10-31 10:03:47,484 DEBUG [ckanext.harvest.plugin] Using auth profile at ckanext.harvest.logic.auth
2012-10-31 10:03:47,526 INFO  [ckanext.harvest.logic.action.create] Creating harvest source: {'user_id': u'', 'url': u'http://www.fsd.uta.fi/fi/aineistot/luettelo/fsd-ddi-records-uris-fi.txt', 'publisher_id': u'', 'type': u'DDI', 'active': True, 'config': None}
2012-10-31 10:03:47,619 INFO  [ckanext.harvest.logic.action.create] Harvest source created: 449616c7-35a0-494d-bea5-57ef78099a3a
2012-10-31 10:03:47,649 INFO  [ckanext.harvest.logic.action.create] Harvest job create: {'source_id': u'449616c7-35a0-494d-bea5-57ef78099a3a'}
2012-10-31 10:03:47,685 INFO  [ckanext.harvest.logic.action.create] Harvest job saved e4957d0b-ffdf-4e6d-b349-4c26fdf8625e

Created new harvest source:
Source id: 449616c7-35a0-494d-bea5-57ef78099a3a
      url: http://www.fsd.uta.fi/fi/aineistot/luettelo/fsd-ddi-records-uris-fi.txt
     type: DDI
   active: True
     user: 
publisher: 
     jobs: 0

There is 1 harvest source
A new Harvest Job for this source has also been created
+ /home/ckan/pyenv/bin/paster --plugin=ckanext-harvest harvester source http://helda.helsinki.fi/oai/request OAI-PMH --config=/home/ckan/pyenv/src/ckan/development.ini
2012-10-31 10:03:49,561 DEBUG [ckanext.harvest.model] Harvest tables defined in memory
2012-10-31 10:03:49,566 DEBUG [ckanext.harvest.model] Harvest tables already exist
2012-10-31 10:03:49,609 DEBUG [ckanext.harvest.plugin] Using auth profile at ckanext.harvest.logic.auth
2012-10-31 10:03:49,637 INFO  [ckanext.harvest.logic.action.create] Creating harvest source: {'user_id': u'', 'url': u'http://helda.helsinki.fi/oai/request', 'publisher_id': u'', 'type': u'OAI-PMH', 'active': True, 'config': None}
2012-10-31 10:03:49,690 INFO  [ckanext.harvest.logic.action.create] Harvest source created: f962f019-3761-47c4-a3c9-27b990cfaa3e
2012-10-31 10:03:49,748 INFO  [ckanext.harvest.logic.action.create] Harvest job create: {'source_id': u'f962f019-3761-47c4-a3c9-27b990cfaa3e'}
2012-10-31 10:03:49,797 INFO  [ckanext.harvest.logic.action.create] Harvest job saved 4c7b76bc-9e33-4623-aa3e-7610302cec5c

Created new harvest source:
Source id: f962f019-3761-47c4-a3c9-27b990cfaa3e
      url: http://helda.helsinki.fi/oai/request
     type: OAI-PMH
   active: True
     user: 
publisher: 
     jobs: 0

There are 2 harvest sources
A new Harvest Job for this source has also been created
+ chkconfig supervisord on
Stopping atd: [FAILED]
Starting atd: [  OK  ]
job 1 at 2012-10-31 10:06
Starting shibd: [  OK  ]
Starting httpd: [  OK  ]
Starting supervisord: 
