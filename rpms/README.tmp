How to clean up before installing a new version of kata-ckan-prod 

(TODO: This should be all handled by our scriptlets when uninstalling
or upgrading our packages, so eventually this file should be empty)


0. Introduction

No changes have happened in apache-solr, so this package does not even
need to be uninstalled.


1.) Clear the search index

$ sudo service supervisord stop
$ sudo service rabbitmq-server stop
                                     (these ensure that harvesters don't
                                     fetch anything new during cleaning)
$ sudo -s -u ckan
$ cd
$ source pyenv/bin/active
$ cd pyenv/src/ckan
$ paster --plugin=ckan search-index clear --config=development.ini
$ exit                               (exit from previous sudo)


2.) Stop remaining services

$ sudo service httpd stop

(postgres will be stopped by kata-ckan-prod uninstallation)


3.) uninstall kata-ckan-prod and mcfg

$ sudo yum remove mcfg           (this will pull kata-ckan-prod with it)


4.) Clean-up of Postgres

$ sudo rm -rf /var/lib/pgsql/data/


5.) Uninstallation of supervisor

(the idea is to get rid of the configuration modified by kata-prod, so we can 
start with a fresh one again)
 
$ sudo yum remove supervisor
$ sudo rm /etc/supervisord.conf.rpmsave

(The rm commands here and in the following steps are only for your
orientation. The idea is to make sure that now configuration of the
package in question should remain. If etckeeper is in use
the appropriate "git rm" commands should be given instead)


6.) Uninstallation of shibboleth

(same idea as with supervisor)

$ sudo yum remove shibboleth
$ sudo rm -r /etc/shibboleth


7.) Uninstallation of apache

(same idea as with supervisor)

$ sudo yum remove httpd
$ sudo rm -r /etc/httpd


8.) Clean-up rabbitmq

$ sudo rm -rf /var/lib/rabbitmq/* 

TODO: It appears that rabbitmq will recreate this
properly when started again. If there are problems it might be
necessary to uninstall the package. (If there are severe problems
older versions of this document contain more debugging info, but currently
I assume that is not needed)
