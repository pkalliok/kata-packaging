Shibboleth2 SP installation
---

Before installing anything related to shibboleth, install apache2 with ssl support and make
sure it works properly. Self signed certificates are just fine. Also before banging head to
wall when nothing works, make sure SELinux is disabled, shibboleth wont work if SELinux is in use.

 * Apache and SSL http://wiki.centos.org/HowTos/Https
 * SELinux http://www.how2centos.com/disable-selinux-centos-6/

Shibboleth2 repo:
 * SP is configured with /etc/shibboleth/shibboleth2.xml, see example shibboleth2.xml

cd /etc/yum.repos.d/
wget http://download.opensuse.org/repositories/security://shibboleth/CentOS_CentOS-6/security:shibboleth.repo
yum update && yum install shibboleth

Repoze.who shibboleth plugin:
 * Propably not needed.

yum install openldap-devel.x86_64
pip install -e git+https://github.com/ralphbean/repoze.who.plugins.shibboleth.git#egg=repoze.who.plugins.shibboleth

Configuration:

cd /etc/shibboleth
sh metagen.sh -c sp-cert.pem -h localhost > metadata.xml
cp metadata.xml /var/www/

Shibboleth2 IdP
---
DO NOT INSTALL FROM CENTOS REPO

 * tutorial: https://wiki.shibboleth.net/confluence/display/SHIB2/IdPSPLocalTestInstall
 * tomcat: http://tomcat.apache.org/download-60.cgi (not 5.x or 7.x, it MUST be tomcat6)
 * shibboleth idp: http://shibboleth.net/downloads/identity-provider/latest/

Java:

 * Donwload latest Java7 SDK from sun microsystems.
 * Install and run update-alternatives
 ** http://minhtech.com/featuredlinux/centos-install-sun-java-se-jre/
 * Set JAVA_HOME=/usr/java/jdk1.7.0_04/

Tomcat:

 * Unpack, install and move to /usr/local/tomcat
 * Set paths:

TOMCAT_HOME=/usr/local/tomcat
CATALINA_HOME=/usr/local/tomcat

export TOMCAT_HOME=$TOMCAT_HOME
export CATALINA_HOME=$CATALINA_HOME

Shibboleth IdP:

 * Unpack and run install.sh
 * Install (default) to /opt/shibboleth-idp
 * Configure IdP /opt/shibboleth-idp/conf/relying-party.xml see example relying-party.xml
 * Copy endorsed jar files to tomcat
 ** /opt/shibboleth-idp/lib/endorsed/* -> /usr/local/tomcat/endorsed/

Apache2:

 * Can be isntalled with yum, or some another package manager
 * Tomcat and SP configurations on apache side, add end of the httpd.conf:
 * /opt/shibboleth-idp/user.db can be created with htpasswd command

ProxyPass /idp/ ajp://localhost:8009/idp/

<Location /idp/Authn/RemoteUser>
    AuthType Basic
    AuthName "My Identity Provider"
    AuthUserFile /opt/shibboleth-idp/user.db
    require valid-user
</Location>
